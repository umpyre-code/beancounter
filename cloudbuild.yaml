steps:
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
   docker pull gcr.io/$PROJECT_ID/github.com/umpyre-code/beancounter:latest || true
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
   docker pull guangie88/rustfmt-clippy:nightly || true
- name: gcr.io/cloud-builders/gsutil
  args: ['-m', 'cp', '-r', 'gs://umpyre-sccache/.cache', '/root']
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args: ['-c', 'docker build --build-arg SSH_KEY="$$SSH_KEY" --build-arg SCCACHE_KEY="$$SCCACHE_KEY"  -t gcr.io/$PROJECT_ID/github.com/umpyre-code/beancounter:latest -t gcr.io/$PROJECT_ID/github.com/umpyre-code/beancounter:$REVISION_ID --cache-from gcr.io/$PROJECT_ID/github.com/umpyre-code/beancounter:latest --cache-from rust:latest .']
  secretEnv: ['SSH_KEY', 'SCCACHE_KEY']
- name: gcr.io/cloud-builders/gsutil
  args: ['-m', 'cp', '-r', '/root/.cache/*', 'gs://umpyre-sccache/.cache']
images: [
   'gcr.io/$PROJECT_ID/github.com/umpyre-code/beancounter:latest','gcr.io/$PROJECT_ID/github.com/umpyre-code/beancounter:$REVISION_ID',
]
timeout: 1h
secrets:
- kmsKeyName: projects/umpyre/locations/global/keyRings/deploy/cryptoKeys/deploy-key
  secretEnv:
    SSH_KEY: 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
    SCCACHE_KEY: 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
